<?xml version="1.0" encoding="UTF-8"?>

<!-- Configures the Camel Context-->
                
<beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xsi:schemaLocation="
       http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd
       http://camel.apache.org/schema/spring http://camel.apache.org/schema/spring/camel-spring.xsd">

	<!-- Endpoints and routes -->
	
	<camelContext id="camel" xmlns="http://camel.apache.org/schema/spring">
		<!--
		<errorHandler id="errorHandlerFTP" type="DeadLetterChannel" deadLetterUri="direct:notificationEndpoint">
    		<redeliveryPolicy maximumRedeliveries="${proEasy.ftp.retries}" redeliveryDelay="${proEasy.ftp.retriesDelay}" logHandled="true" asyncDelayedRedelivery="true"/>
		</errorHandler>
		-->
		<endpoint id="rssFeed1" uri="rss:http://localhost/feed?consumer.delay=300s&amp;splitEntries=true&amp;throttleEntries=false"/>
                
                <endpoint id="rssFeed2" uri="rss:http://localhost/feed2.xml?consumer.delay=300s&amp;splitEntries=true&amp;throttleEntries=false"/>
                
                <!--<endpoint id="mergeFeeds" uri="seda:merging?concurrentConsumers=${proeasy.numThreads}&amp;waitForTaskToComplete=Never&amp;timeout=0"/>-->
                <route>
                        <from ref="rssFeed1"/>
			<to uri="direct:mergeFeeds" />
		</route>

                <route>
                        <from ref="rssFeed2"/>
			<to uri="direct:mergeFeeds" />
		</route>
                
                <route>
                        <from uri="direct:mergeFeeds"/>
                        <aggregate strategyRef="rssAggregationStrategy" completionTimeout="5000">
                            <correlationExpression>
                                <constant>true</constant>
                            </correlationExpression>
                            <to uri="direct:prcocessEntries"/>
                        </aggregate>
                </route>
                
                <route>
                    <from uri="direct:prcocessEntries"/>
                    <process ref="rssConsumer"/>
                    <process ref="parserProcessor"/>
                    <process ref="filterProcessor"/>
                </route>
                
	</camelContext>
</beans>
