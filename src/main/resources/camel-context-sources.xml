<?xml version="1.0" encoding="UTF-8"?>

<!-- Configures the Camel Context-->
                
<beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xsi:schemaLocation="
       http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd
       http://camel.apache.org/schema/spring http://camel.apache.org/schema/spring/camel-spring.xsd" xmlns:ns2="null">

	<!-- Endpoints and routes -->
	
	<camelContext id="camel" xmlns="http://camel.apache.org/schema/spring">

                <contextScan/>
		
                <route>
                        <from uri="direct:mergeFeeds"/>
                        <aggregate strategyRef="rssAggregationStrategy" completionTimeout="5000">
                            <correlationExpression>
                                <constant>true</constant>
                            </correlationExpression>
                            <to uri="direct:prcocessEntries"/>
                        </aggregate>
                </route>
                
                <route>
                    <from uri="direct:prcocessEntries"/>
                    <process ref="rssConsumer"/>
                    <process ref="parserProcessor"/>
                    <process ref="filterProcessor"/>
                    <to uri="direct:splitDownloads"/>
                </route>
                
                <route>
                    <from uri="direct:splitDownloads"/>
                    <split>
                        <simple>body</simple>
                        <to uri="direct:processDownload"/>
                    </split>
                </route>
                
                <route>
                    <from uri="direct:processDownload"/>
                    <process ref="queueProcessor"/>
                </route>
                
                
	</camelContext>
</beans>
